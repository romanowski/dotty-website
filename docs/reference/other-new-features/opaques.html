<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Opaque Type Aliases</title><link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico"></link><script type="text/javascript" src="../../../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../../../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../../../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../../../styles/nord-light.css"></link><link rel="stylesheet" href="../../../styles/scalastyle.css"></link><link rel="stylesheet" href="../../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../../styles/diagram.css"></link><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="../../../scripts/diagram.js" defer="true"></script><link rel="stylesheet" href="../../../styles/filter-bar.css"></link><script type="text/javascript" src="../../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../../scripts/data.js" defer="true"></script><script type="text/javascript" src="../../../scripts/fast-navigation-loader.js" defer="true"></script><link rel="stylesheet" href="../../../css/bootstrap.min.css"></link><link rel="stylesheet" href="../../../css/dottydoc.css"></link><link rel="stylesheet" href="../../../css/color-brewer.css"></link><script type="text/javascript" src="../../../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../../../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../../../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../../../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3</div><div class="projectVersion">3.0.0-M2</div></span></div><div id="paneSearch"></div><nav id="sideMenu"></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="_.docs/reference/other-new-features/opaques.md////PointingToDeclaration//-624007177">
    <div class="breadcrumbs"><a href="../../index.html"></a>/<a href="../../Reference/index.html">Reference</a>/<a href="../../Other New Features/index.html">Other New Features</a>/<a href="opaques.html">Opaque Type Aliases</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>"Opaque Type Aliases"</h1> 
     <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/master/docs/docs/reference/other-new-features/opaques.md#L"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
     </div> 
    </header> 
    <p>Opaque types aliases provide type abstraction without any overhead. Example:</p> 
    <pre><code class="language-scala">object Logarithms {

  opaque type Logarithm = Double

  object Logarithm {

    // These are the two ways to lift to the Logarithm type

    def apply(d: Double): Logarithm = math.log(d)

    def safe(d: Double): Option[Logarithm] =
      if (d &gt; 0.0) Some(math.log(d)) else None
  }

  // Extension methods define opaque types' public APIs
  extension (x: Logarithm) {
    def toDouble: Double = math.exp(x)
    def + (y: Logarithm): Logarithm = Logarithm(math.exp(x) + math.exp(y))
    def * (y: Logarithm): Logarithm = x + y
  }
}
</code></pre> 
    <p>This introduces <code>Logarithm</code> as a new abstract type, which is implemented as <code>Double</code>. The fact that <code>Logarithm</code> is the same as <code>Double</code> is only known in the scope where <code>Logarithm</code> is defined which in the above example corresponds to the object <code>Logarithms</code>. Or in other words, within the scope it is treated as type alias, but this is opaque to the outside world where in consequence <code>Logarithm</code> is seen as an abstract type and has nothing to do with <code>Double</code>.</p> 
    <p>The public API of <code>Logarithm</code> consists of the <code>apply</code> and <code>safe</code> methods defined in the companion object. They convert from <code>Double</code>s to <code>Logarithm</code> values. Moreover, an operation <code>toDouble</code> that converts the other way, and operations <code>+</code> and <code>*</code> are defined as extension methods on <code>Logarithm</code> values. The following operations would be valid because they use functionality implemented in the <code>Logarithms</code> object.</p> 
    <pre><code class="language-scala">import Logarithms.Logarithm

val l = Logarithm(1.0)
val l2 = Logarithm(2.0)
val l3 = l * l2
val l4 = l + l2
</code></pre> 
    <p>But the following operations would lead to type errors:</p> 
    <pre><code class="language-scala">val d: Double = l       // error: found: Logarithm, required: Double
val l2: Logarithm = 1.0 // error: found: Double, required: Logarithm
l * 2                   // error: found: Int(2), required: Logarithm
l / l2                  // error: `/` is not a member of Logarithm
</code></pre> 
    <h3><a href="#bounds-for-opaque-type-aliases" id="bounds-for-opaque-type-aliases" class="anchor"></a>Bounds For Opaque Type Aliases</h3> 
    <p>Opaque type aliases can also come with bounds. Example:</p> 
    <pre><code class="language-scala">object Access {

  opaque type Permissions = Int
  opaque type PermissionChoice = Int
  opaque type Permission &lt;: Permissions &amp; PermissionChoice = Int

  extension (x: Permissions) def &amp; (y: Permissions): Permissions = x | y
  extension (x: PermissionChoice) def | (y: PermissionChoice): PermissionChoice = x | y
  extension (granted: Permissions) def is(required: Permissions) = (granted &amp; required) == required
  extension (granted: Permissions) def isOneOf(required: PermissionChoice) = (granted &amp; required) != 0

  val NoPermission: Permission = 0
  val Read: Permission = 1
  val Write: Permission = 2
  val ReadWrite: Permissions = Read | Write
  val ReadOrWrite: PermissionChoice = Read | Write
}
</code></pre> 
    <p>The <code>Access</code> object defines three opaque type aliases:</p> 
    <ul> 
     <li><code>Permission</code>, representing a single permission,</li> 
     <li><code>Permissions</code>, representing a set of permissions with the meaning "all of these permissions granted",</li> 
     <li><code>PermissionChoice</code>, representing a set of permissions with the meaning "at least one of these permissions granted".</li> 
    </ul> 
    <p>Outside the <code>Access</code> object, values of type <code>Permissions</code> may be combined using the <code>&amp;</code> operator, where <code>x &amp; y</code> means "all permissions in <code>x</code> <em>and</em> in <code>y</code> granted". Values of type <code>PermissionChoice</code> may be combined using the <code>|</code> operator, where <code>x | y</code> means "a permission in <code>x</code> <em>or</em> in <code>y</code> granted".</p> 
    <p>Note that inside the <code>Access</code> object, the <code>&amp;</code> and <code>|</code> operators always resolve to the corresponding methods of <code>Int</code>, because members always take precedence over extension methods. Because of that, the <code>|</code> extension method in <code>Access</code> does not cause infinite recursion. Also, the definition of <code>ReadWrite</code> must use <code>|</code>, even though an equivalent definition outside <code>Access</code> would use <code>&amp;</code>.</p> 
    <p>All three opaque type aliases have the same underlying representation type <code>Int</code>. The <code>Permission</code> type has an upper bound <code>Permissions &amp; PermissionChoice</code>. This makes it known outside the <code>Access</code> object that <code>Permission</code> is a subtype of the other two types. Hence, the following usage scenario type-checks.</p> 
    <pre><code class="language-scala">object User {
  import Access._

  case class Item(rights: Permissions)

  val roItem = Item(Read)  // OK, since Permission &lt;: Permissions
  val rwItem = Item(ReadWrite)
  val noItem = Item(NoPermission)

  assert( roItem.rights.is(ReadWrite) == false )
  assert( roItem.rights.isOneOf(ReadOrWrite) == true )

  assert( rwItem.rights.is(ReadWrite) == true )
  assert( rwItem.rights.isOneOf(ReadOrWrite) == true )

  assert( noItem.rights.is(ReadWrite) == false )
  assert( noItem.rights.isOneOf(ReadOrWrite) == false )
}
</code></pre> 
    <p>On the other hand, the call <code>roItem.rights.isOneOf(ReadWrite)</code> would give a type error since <code>Permissions</code> and <code>PermissionChoice</code> are different, unrelated types outside <code>Access</code>.</p> 
    <p><a href="opaques-details.html">More details</a></p> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span>Generated by&nbsp;<a href="https://github.com/lampepfl/dotty/tree/master/scala3doc"><img src="../../../images/scala3doc_logo.svg" alt="Scala3doc" class="scala3doc_logo"></img></a></footer></div></div><script type="text/javascript" src="../../../scripts/pages.js"></script><script type="text/javascript" src="../../../scripts/main.js"></script></body></html>
