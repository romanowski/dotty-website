<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Testing in Dotty</title><link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico"></link><script type="text/javascript" src="../../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../../styles/nord-light.css"></link><link rel="stylesheet" href="../../styles/scalastyle.css"></link><link rel="stylesheet" href="../../styles/dotty-icons.css"></link><link rel="stylesheet" href="../../styles/diagram.css"></link><link rel="stylesheet" href="../../styles/filter-bar.css"></link><link rel="stylesheet" href="../../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="../../scripts/diagram.js" defer="true"></script><link rel="stylesheet" href="../../styles/filter-bar.css"></link><script type="text/javascript" src="../../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../../scripts/data.js" defer="true"></script><script type="text/javascript" src="../../scripts/fast-navigation-loader.js" defer="true"></script><link rel="stylesheet" href="../../css/bootstrap.min.css"></link><link rel="stylesheet" href="../../css/dottydoc.css"></link><link rel="stylesheet" href="../../css/color-brewer.css"></link><script type="text/javascript" src="../../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"><span><img src="../../project-logo/logo.svg"></img></span><span><div class="projectName">Scala 3</div><div class="projectVersion">3.0.0-M2</div></span></div><div id="paneSearch"></div><nav id="sideMenu"></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="_.docs/contributing/testing.md////PointingToDeclaration//-624007177">
    <div class="breadcrumbs"><a href="../index.html"></a>/<a href="../Contributing/index.html">Contributing</a>/<a href="testing.html">Testing in Dotty</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>Testing in Dotty</h1> 
     <div class="byline"> <a href="https://github.com/lampepfl/dotty/edit/master/docs/docs/contributing/testing.md#L"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
     </div> 
    </header> 
    <p>Running all tests in Dotty is as simple as:</p> 
    <pre><code class="language-bash">$ sbt test
</code></pre> 
    <p>Specifically, <code>sbt test</code> runs all tests that do <em>not</em> require a bootstrapped compiler. In practice, this means that it runs all compilation tests meeting this criterion, as well as all non-compiler tests.</p> 
    <p>The entire suite of tests can be run using the bootstrapped compiler as follows:</p> 
    <pre><code class="language-bash">$ sbt
&gt; dotty-bootstrapped/test
</code></pre> 
    <p>There are currently several forms of tests in Dotty. These can be split into two categories:</p> 
    <h2><a href="#unit-tests" id="unit-tests" class="anchor"></a>Unit tests</h2> 
    <p>These tests can be found in <code>&lt;sub-project&gt;/test</code> and are used to check functionality of specific parts of the codebase in isolation e.g: parsing, scanning and message errors.</p> 
    <p>To run all tests in e.g., for the compiler test-suite you can write:</p> 
    <pre><code class="language-bash">$ sbt
&gt; dotty-compiler/test
</code></pre> 
    <p>To run a single test class you use <code>testOnly</code> and the fully qualified class name. For example:</p> 
    <pre><code class="language-bash">&gt; testOnly dotty.tools.dotc.transform.TreeTransformerTest
</code></pre> 
    <p>The test command follows a regular expression-based syntax <code>testOnly * -- *</code>. The right-hand side picks a range of names for methods and the left-hand side picks a range of class names and their fully-qualified paths.</p> 
    <p>Consequently, you can restrict the aforementioned executed test to a subset of methods by appending <code>-- *method_name</code>. The example below picks up all methods with the name <code>canOverwrite</code>:</p> 
    <pre><code class="language-bash">&gt; testOnly dotty.tools.dotc.transform.TreeTransformerTest -- *canOverwrite
</code></pre> 
    <p>Additionally, you can run all tests named <code>method_name</code>, in any class, without providing a class name:</p> 
    <pre><code class="language-bash">&gt; testOnly -- *canOverwrite
</code></pre> 
    <p>You can also run all paths of classes of a certain name:</p> 
    <pre><code class="language-bash">&gt; testOnly *.TreeTransformerTest
</code></pre> 
    <h3><a href="#testing-with-checkfiles" id="testing-with-checkfiles" class="anchor"></a>Testing with checkfiles</h3> 
    <p>Some tests support checking the output of the run or the compilation against a checkfile. A checkfile is a file in which the expected output of the compilation or run is defined. A test against a checkfile fails if the actual output mismatches the expected output.</p> 
    <p>Currently, the <code>run</code> and <code>neg</code> (compilation must fail for the test to succeed) tests support the checkfiles. <code>run</code>'s checkfiles contain an expected run output of the successfully compiled program. <code>neg</code>'s checkfiles contain an expected error output during compilation.</p> 
    <p>Absence of a checkfile is <strong>not</strong> a condition for the test failure. E.g. if a <code>neg</code> test fails with the expected number of errors and there is no checkfile for it, the test still passes.</p> 
    <p>Checkfiles are located in the same directories as the tests they check, have the same name as these tests with the extension <code>*.check</code>. E.g. if you have a test named <code>tests/neg/foo.scala</code>, you can create a checkfile for it named <code>tests/neg/foo.check</code>. And if you have a test composed of several files in a single directory, e.g. <code>tests/neg/manyScalaFiles</code>, the checkfile will be <code>tests/neg/manyScalaFiles.check</code>.</p> 
    <p>If the actual output mismatches the expected output, the test framework will dump the actual output in the file <code>*.check.out</code> and fail the test suite. It will also output the instructions to quickly replace the expected output with the actual output, in the following format:</p> 
    <pre><code>Test output dumped in: tests/playground/neg/Sample.check.out
  See diff of the checkfile
    &gt; diff tests/playground/neg/Sample.check tests/playground/neg/Sample.check.out
  Replace checkfile with current output
    &gt; mv tests/playground/neg/Sample.check.out tests/playground/neg/Sample.check
</code></pre> 
    <p>To create a checkfile for a test, you can do one of the following:</p> 
    <ul> 
     <li>Create a dummy checkfile with a random content, run the test, and, when it fails, use the <code>mv</code> command reported by the test to replace the dummy checkfile with the actual output.</li> 
     <li>Manually compile the file you are testing with <code>scalac</code> and copy-paste whatever console output the compiler produces to the checkfile.</li> 
    </ul> 
    <h2><a href="#integration-tests" id="integration-tests" class="anchor"></a>Integration tests</h2> 
    <p>These tests are Scala source files expected to compile with Dotty (pos tests), along with their expected output (run tests) or errors (neg tests).</p> 
    <p>All of these tests are contained in the <code>./tests/*</code> directories and can be run with the <code>testCompilation</code> command. Tests in folders named <code>with-compiler</code> are an exception, see next section.</p> 
    <p>Currently to run these tests you need to invoke from sbt:</p> 
    <pre><code class="language-bash">$ sbt
&gt; testCompilation
</code></pre> 
    <p>(which is effectively the same with <code>testOnly dotty.tools.dotc.CompilationTests</code>)</p> 
    <p>It is also possible to run tests filtered, again from sbt:</p> 
    <pre><code class="language-bash">$ sbt
&gt; testCompilation companions
</code></pre> 
    <p>This will run both the test <code>./tests/pos/companions.scala</code> and <code>./tests/neg/companions.scala</code> since both of these match the given string. This also means that you could run <code>testCompilation</code> with no arguments to run all integration tests.</p> 
    <p>When complex checkfiles must be updated, <code>testCompilation</code> can run in a mode where it overrides the checkfiles with the test outputs.</p> 
    <pre><code class="language-bash">$ sbt
&gt; testCompilation --update-checkfiles
</code></pre> 
    <p>Use <code>--help</code> to see all the options</p> 
    <pre><code class="language-bash">$ sbt
&gt; testCompilation --help
</code></pre> 
    <h3><a href="#bootstrapped-only-tests" id="bootstrapped-only-tests" class="anchor"></a>Bootstrapped-only tests</h3> 
    <p>To run <code>testCompilation</code> on a bootstrapped Dotty compiler, use <code>dotty-compiler-bootstrapped/testCompilation</code> (with the same syntax as above). Some tests can only be run in bootstrapped compilers; that includes all tests with <code>with-compiler</code> in their name.</p> 
    <h3><a href="#from-tasty-tests" id="from-tasty-tests" class="anchor"></a>From TASTy tests</h3> 
    <p><code>testCompilation</code> has an additional mode to run tests that compile code from a <code>.tasty</code> file. Modify blacklist and whitelists in <code>compiler/test/dotc</code> to enable or disable tests from <code>.tasty</code> files.</p> 
    <pre><code class="language-bash">$ sbt
&gt; testCompilation --from-tasty
</code></pre> 
    <p>This mode can be run under <code>dotty-compiler-bootstrapped/testCompilation</code> to test on a bootstrapped Dotty compiler.</p> 
    <h3><a href="#semanticdb-tests" id="semanticdb-tests" class="anchor"></a>SemanticDB tests</h3> 
    <p>The output of the <code>extractSemanticDB</code> phase, enabled with <code>-Ysemanticdb</code> is tested with the bootstrapped JUnit test <code>dotty.tools.dotc.semanticdb.SemanticdbTests</code>. It uses source files in <code>tests/semanticdb/expect</code> to generate two kinds of output file that are compared with "expect files": placement of semanticdb symbol occurrences inline in sourcecode (<code>*.expect.scala</code>), for human verification by inspection; and secondly metap formatted output which outputs all information stored in semanticdb (<code>metac.expect</code>). Expect files are used as regression tests to detect changes in the compiler.</p> 
    <p>The test suite will create a new file if it detects any difference, which can be compared with the original expect file, or if the user wants to globally replace all expect files for semanticdb they can use <code>dotty-compiler-bootstrapped/test:runMain dotty.tools.dotc.semanticdb.updateExpect</code>, and compare the changes via version control.</p> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span>Generated by&nbsp;<a href="https://github.com/lampepfl/dotty/tree/master/scala3doc"><img src="../../images/scala3doc_logo.svg" alt="Scala3doc" class="scala3doc_logo"></img></a></footer></div></div><script type="text/javascript" src="../../scripts/pages.js"></script><script type="text/javascript" src="../../scripts/main.js"></script></body></html>
