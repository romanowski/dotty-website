<html><head><meta charset="utf-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><title>Opaque Type Aliases: More Details</title><script type="text/javascript" src="../scripts/clipboard.js" defer="true"></script><script type="text/javascript" src="../scripts/platform-content-handler.js" defer="true"></script><script type="text/javascript" src="../scripts/main.js" defer="true"></script><link rel="stylesheet" href="../styles/nord-light.css"></link><link rel="stylesheet" href="../styles/scalastyle.css"></link><link rel="stylesheet" href="../styles/dotty-icons.css"></link><link rel="stylesheet" href="../styles/diagram.css"></link><link rel="stylesheet" href="../styles/filter-bar.css"></link><link rel="stylesheet" href="../styles/search-bar.css"></link><script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" defer="true"></script><script type="text/javascript" src="https://d3js.org/d3.v6.min.js" defer="true"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/graphlib-dot@0.6.2/dist/graphlib-dot.min.js" defer="true"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dagre-d3/0.6.1/dagre-d3.min.js" defer="true"></script><script type="text/javascript" src="../scripts/diagram.js" defer="true"></script><link rel="stylesheet" href="../styles/filter-bar.css"></link><script type="text/javascript" src="../hljs/highlight.pack.js" defer="true"></script><script type="text/javascript" src="../scripts/hljs-scala3.js" defer="true"></script><script type="text/javascript" src="../scripts/ux.js" defer="true"></script><script type="text/javascript" src="../scripts/common/component.js" defer="true"></script><script type="text/javascript" src="../scripts/common/utils.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterBar.js" defer="true"></script><script type="text/javascript" src="../scripts/components/DocumentableList.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Input.js" defer="true"></script><script type="text/javascript" src="../scripts/components/FilterGroup.js" defer="true"></script><script type="text/javascript" src="../scripts/components/Filter.js" defer="true"></script><script type="text/javascript" src="../scripts/data.js" defer="true"></script><script type="text/javascript" src="../scripts/fast-navigation-loader.js" defer="true"></script><link rel="stylesheet" href="../css/bootstrap.min.css"></link><link rel="stylesheet" href="../css/dottydoc.css"></link><link rel="stylesheet" href="../css/color-brewer.css"></link><script type="text/javascript" src="../js/jquery.min.js" defer="true"></script><script type="text/javascript" src="../js/bootstrap.min.js" defer="true"></script><script>var pathToRoot = "../";</script></head><body><div id="container"><div id="leftColumn"><div id="logo"></div><div id="paneSearch"></div><nav id="sideMenu"></nav></div><div id="main"><div id="leftToggler"><span class="icon-toggler"></span></div><div id="searchBar"></div><main>
  <div id="content" pageIds="_.docs/reference/other-new-features/opaques-details.md////PointingToDeclaration//-1025483213">
    <div class="breadcrumbs"><a href="index.html"></a>/<a href="opaques-details.html">Opaque Type Aliases: More Details</a></div>
<html>
 <head>
  <link rel="dns-prefetch" href="//fonts.googleapis.com"> 
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"> 
 </head>
 <body>
  <div id="content-wrapper"> 
   <main class="container"> 
    <header> 
     <h1>"Opaque Type Aliases: More Details"</h1> 
     <div class="byline"> <a href="/edit/master//"> <i class="far fa-edit"></i> Edit this page on GitHub </a> 
     </div> 
    </header> 
    <h3>Syntax</h3> 
    <pre><code>Modifier          ::=  ...
                    |  ‘opaque’
</code></pre> 
    <p><code>opaque</code> is a <a href="../soft-modifier.md">soft modifier</a>. It can still be used as a normal identifier when it is not in front of a definition keyword.</p> 
    <p>Opaque type aliases must be members of classes, traits, or objects, or they are defined at the top-level. They cannot be defined in local blocks.</p> 
    <h3>Type Checking</h3> 
    <p>The general form of a (monomorphic) opaque type alias is</p> 
    <pre><code class="language-scala">opaque type T &gt;: L &lt;: U = R
</code></pre> 
    <p>where the lower bound <code>L</code> and the upper bound <code>U</code> may be missing, in which case they are assumed to be <code>scala.Nothing</code> and <code>scala.Any</code>, respectively. If bounds are given, it is checked that the right hand side <code>R</code> conforms to them, i.e. <code>L &lt;: R</code> and <code>R &lt;: U</code>. F-bounds are not supported for opaque type aliases: <code>T</code> is not allowed to appear in <code>L</code> or <code>U</code>.</p> 
    <p>Inside the scope of the alias definition, the alias is transparent: <code>T</code> is treated as a normal alias of <code>R</code>. Outside its scope, the alias is treated as the abstract type</p> 
    <pre><code class="language-scala">type T &gt;: L &lt;: U
</code></pre> 
    <p>A special case arises if the opaque type alias is defined in an object. Example:</p> 
    <pre><code>object o {
  opaque type T = R
}
</code></pre> 
    <p>In this case we have inside the object (also for non-opaque types) that <code>o.T</code> is equal to <code>T</code> or its expanded form <code>o.this.T</code>. Equality is understood here as mutual subtyping, i.e. <code>o.T &lt;: o.this.T</code> and <code>o.this.T &lt;: T</code>. Furthermore, we have by the rules of opaque type aliases that <code>o.this.T</code> equals <code>R</code>. The two equalities compose. That is, inside <code>o</code>, it is also known that <code>o.T</code> is equal to <code>R</code>. This means the following code type-checks:</p> 
    <pre><code class="language-scala">object o {
  opaque type T = Int
  val x: Int = id(2)
}
def id(x: o.T): o.T = x
</code></pre> 
    <h3>Type Parameters of Opaque Types</h3> 
    <p>Opaque type aliases can have a single type parameter list. The following aliases are well-formed</p> 
    <pre><code class="language-scala">opaque type F[T] = (T, T)
opaque type G = [T] =&gt;&gt; List[T]
</code></pre> 
    <p>but the following are not:</p> 
    <pre><code class="language-scala">opaque type BadF[T] = [U] =&gt;&gt; (T, U)
opaque type BadG = [T] =&gt;&gt; [U] =&gt; (T, U)
</code></pre> 
    <h3>Translation of Equality</h3> 
    <p>Comparing two values of opaque type with <code>==</code> or <code>!=</code> normally uses universal equality, unless another overloaded <code>==</code> or <code>!=</code> operator is defined for the type. To avoid boxing, the operation is mapped after type checking to the (in-)equality operator defined on the underlying type. For instance,</p> 
    <pre><code class="language-scala">  opaque type T = Int

  ...
  val x: T
  val y: T
  x == y    // uses Int equality for the comparison.
</code></pre> 
    <h3>Toplevel Opaque Types</h3> 
    <p>An opaque type alias on the toplevel is transparent in all other toplevel definitions in the sourcefile where it appears, but is opaque in nested objects and classes and in all other source files. Example:</p> 
    <pre><code class="language-scala">// in test1.scala
opaque type A = String
val x: A = "abc"

object obj {
  val y: A = "abc"  // error: found: "abc", required: A
}

// in test2.scala
def z: String = x   // error: found: A, required: String
</code></pre> 
    <p>This behavior becomes clear if one recalls that toplevel definitions are placed in their own synthetic object. For instance, the code in <code>test1.scala</code> would expand to</p> 
    <pre><code class="language-scala">object test1$package {
  opaque type A = String
  val x: A = "abc"
}
object obj {
  val y: A = "abc"  // error: cannot assign "abc" to opaque type alias A
}
</code></pre> 
    <p>The opaque type alias <code>A</code> is transparent in its scope, which includes the definition of <code>x</code>, but not the definitions of <code>obj</code> and <code>y</code>.</p> 
    <h3>Relationship to SIP 35</h3> 
    <p>Opaque types in Dotty are an evolution from what is described in <a href="https://docs.scala-lang.org/sips/opaque-types.html">Scala SIP 35</a>.</p> 
    <p>The differences compared to the state described in this SIP are:</p> 
    <ol> 
     <li>Opaque type aliases cannot be defined anymore in local statement sequences.</li> 
     <li>The scope where an opaque type alias is visible is now the whole scope where it is defined, instead of just a companion object.</li> 
     <li>The notion of a companion object for opaque type aliases has been dropped.</li> 
     <li>Opaque type aliases can have bounds.</li> 
     <li>The notion of type equality involving opaque type aliases has been clarified. It was strengthened with respect to the previous implementation of SIP 35.</li> 
    </ol> 
   </main> 
  </div> 
  <script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'lampepfl/dotty'
  };
</script> 
  <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
 </body>
</html>  </div>
</main><footer><span class="go-to-top-icon"><a href="#container"><span class="icon-vertical_align_top"></span>&nbsp;Back to top</a></span><span class="pull-right">Generated by&nbsp;<a href="https://github.com/lampepfl/scala3doc">Scala3doc</a></span></footer></div></div><script type="text/javascript" src="../scripts/pages.js"></script><script type="text/javascript" src="../scripts/main.js"></script></body></html>
